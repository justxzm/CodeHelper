<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <style>
      :root {
        --c-bg: #fff;
      }

      html.dark {
        --c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="icon" href="https://vuejs.press/images/hero.png"><title>范式化功能 | IBMS开发辅助</title><meta name="description" content="定制快人一步，范式化编程，更完善更稳定">
    <link rel="stylesheet" href="/CodeHelper/assets/css/styles.59ea3f1c.css">
    <link rel="preload" href="/CodeHelper/assets/js/runtime~app.19208902.js" as="script"><link rel="preload" href="/CodeHelper/assets/css/styles.59ea3f1c.css" as="style"><link rel="preload" href="/CodeHelper/assets/js/639.a736eac9.js" as="script"><link rel="preload" href="/CodeHelper/assets/js/app.e67bbaa2.js" as="script">
    <link rel="prefetch" href="/CodeHelper/assets/js/前后端代码段.html.3b6fcd02.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/范式化功能.html.3fbb4a58.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/组件化页面.html.ff3d23dc.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/数据库语句.html.4d9b568c.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/平台源码相关.html.a32f421c.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/业务工具类.html.8fbf4219.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/快速开始BAK.html.aa645313.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/快速开始.html.704c5d76.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/index.html.e652a897.js" as="script"><link rel="prefetch" href="/CodeHelper/assets/js/404.html.63643623.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon"><!--[--><header class="vp-navbar"><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/CodeHelper/"><!----><span class="vp-site-name" aria-hidden="true">IBMS开发辅助</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/CodeHelper/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/CodeHelper/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.html" aria-label="快速开始"><!---->快速开始<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="文档"><span class="title">文档</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="文档"><span class="title">文档</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%AE%B5.html" aria-label="前后端代码段"><!---->前后端代码段<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/CodeHelper/%E8%8C%83%E5%BC%8F%E5%8C%96%E5%8A%9F%E8%83%BD.html" aria-label="范式化功能"><!---->范式化功能<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E7%BB%84%E4%BB%B6%E5%8C%96%E9%A1%B5%E9%9D%A2.html" aria-label="组件化页面"><!---->组件化页面<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E5%8F%A5.html" aria-label="数据库语句"><!---->数据库语句<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E5%B9%B3%E5%8F%B0%E6%BA%90%E7%A0%81%E7%9B%B8%E5%85%B3.html" aria-label="平台源码相关"><!---->平台源码相关<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/CodeHelper/%E4%B8%9A%E5%8A%A1%E5%B7%A5%E5%85%B7%E7%B1%BB.html" aria-label="工具类下载"><!---->工具类下载<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://justxzm.github.io/" aria-label="其他经验" rel="noopener noreferrer" target="_blank"><!---->其他经验<!----></a></div><!--]--></nav><!--[--><!--]--><button class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar"><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/CodeHelper/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/CodeHelper/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.html" aria-label="快速开始"><!---->快速开始<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="文档"><span class="title">文档</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="文档"><span class="title">文档</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%AE%B5.html" aria-label="前后端代码段"><!---->前后端代码段<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/CodeHelper/%E8%8C%83%E5%BC%8F%E5%8C%96%E5%8A%9F%E8%83%BD.html" aria-label="范式化功能"><!---->范式化功能<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E7%BB%84%E4%BB%B6%E5%8C%96%E9%A1%B5%E9%9D%A2.html" aria-label="组件化页面"><!---->组件化页面<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E5%8F%A5.html" aria-label="数据库语句"><!---->数据库语句<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/CodeHelper/%E5%B9%B3%E5%8F%B0%E6%BA%90%E7%A0%81%E7%9B%B8%E5%85%B3.html" aria-label="平台源码相关"><!---->平台源码相关<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/CodeHelper/%E4%B8%9A%E5%8A%A1%E5%B7%A5%E5%85%B7%E7%B1%BB.html" aria-label="工具类下载"><!---->工具类下载<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://justxzm.github.io/" aria-label="其他经验" rel="noopener noreferrer" target="_blank"><!---->其他经验<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">范式化功能 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="范式化功能" tabindex="-1"><a class="header-anchor" href="#范式化功能"><span>范式化功能</span></a></h1><h2 id="_1-流程后置事件" tabindex="-1"><a class="header-anchor" href="#_1-流程后置事件"><span>1 流程后置事件</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token comment">//postevent，后置脚本</span></span>
<span class="line"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;流程后置事件&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span><span class="token string">&quot;flowPostEvent&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ResourceMethod</span><span class="token punctuation">(</span>methodName <span class="token operator">=</span> <span class="token string">&quot;流程后置事件&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">xxPostEvent</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">JSONObject</span> params<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;nodeType&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> nodeType<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> actionType <span class="token operator">=</span> <span class="token class-name">MyScriptUtil</span><span class="token punctuation">.</span><span class="token function">getActionType</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nodeType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;endProcess&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> </span>
<span class="line">            <span class="token punctuation">(</span>nodeType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span></span>
<span class="line">            <span class="token punctuation">(</span><span class="token operator">!</span>actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;approve&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;startFlow&quot;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;endProcess&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//其他事件不触发</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;endProcess&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> actionType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        nodeType <span class="token operator">=</span> <span class="token string">&quot;stop&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token class-name">String</span> businessKey <span class="token operator">=</span> <span class="token class-name">MyScriptUtil</span><span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">flowPostEvent</span><span class="token punctuation">(</span>businessKey<span class="token punctuation">,</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//posteventInt，后置脚本接口</span></span>
<span class="line"><span class="token comment">//流程后置事件</span></span>
<span class="line"><span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">flowPostEvent</span><span class="token punctuation">(</span><span class="token class-name">String</span> businessKey<span class="token punctuation">,</span><span class="token class-name">String</span> nodeType<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//posteventImp，后置脚本实现</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span><span class="token comment">//流程后置事件</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">flowPostEvent</span><span class="token punctuation">(</span><span class="token class-name">String</span> businessKey<span class="token punctuation">,</span> <span class="token class-name">String</span> nodeType<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;stop&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-流程人员脚本" tabindex="-1"><a class="header-anchor" href="#_2-流程人员脚本"><span>2 流程人员脚本</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;得到二级库配套库管员&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;getSecoutstorageUsers&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ResourceMethod</span><span class="token punctuation">(</span>methodName <span class="token operator">=</span> <span class="token string">&quot;得到二级库配套库管员&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSecoutstorageUsers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;businessKey&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> businessKey<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">getSecoutstorageUsers</span><span class="token punctuation">(</span>businessKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//得到二级库配套库管员</span></span>
<span class="line"><span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSecoutstorageUsers</span><span class="token punctuation">(</span><span class="token class-name">String</span> businessKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Override</span><span class="token comment">//得到二级库配套库管员</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSecoutstorageUsers</span><span class="token punctuation">(</span><span class="token class-name">String</span> businessKey<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userCodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">OutstorageApplay</span> outstorageApplay <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>businessKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> ejkgyCodes <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outstorageApplay<span class="token punctuation">.</span><span class="token function">getEjkgycode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>ejkgyCodes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ejkgyCodeSet <span class="token operator">=</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span>ejkgyCodes<span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> userCode<span class="token operator">:</span>ejkgyCodeSet<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            userCodes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>userCodes<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-导入" tabindex="-1"><a class="header-anchor" href="#_3-导入"><span>3 导入</span></a></h2><h3 id="【导入模板下载】" tabindex="-1"><a class="header-anchor" href="#【导入模板下载】"><span>【导入模板下载】</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> downloadFileByBlob <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@ibms/tools&#39;</span></span>
<span class="line"><span class="token comment">//下载模板</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token function">handledownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/finance/budgetPeriod/downLoadBudgetPeriod?fileName=预算期间表导入模板.xlsx</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">&#39;blob&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">downloadFileByBlob</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;任务表导入模板下载&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;downLoadProjectPlan&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ResourceMethod</span><span class="token punctuation">(</span>methodName <span class="token operator">=</span> <span class="token string">&quot;任务表导入模板下载&quot;</span><span class="token punctuation">,</span> permission <span class="token operator">=</span> <span class="token class-name">PermissionType</span><span class="token punctuation">.</span><span class="token constant">PRIVATE</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@QueryLog</span><span class="token punctuation">(</span>detail <span class="token operator">=</span> <span class="token string">&quot;&#39;下载了&#39;+#moduleName+&#39;导入模板，文件名称为【&#39;+#fileName+&#39;】&#39;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ApiImplicitParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;fileName&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;文件名&quot;</span><span class="token punctuation">,</span> paramType <span class="token operator">=</span> <span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> dataType <span class="token operator">=</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downLoadProjectPlan</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;fileName&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">downLoadProjectPlan</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downLoadProjectPlan</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Expose-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Content-Disposition&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Disposition&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attachment; filename=&quot;</span> <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/octet-stream; charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;项目计划导入模板.xlsx&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> exportProjectPlanList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ProjectPlan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token string">&quot;任务表&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span>exportProjectPlanList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;项目计划导入模板.mpp&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">ClassPathResource</span> classPathResource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;template&quot;</span><span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator<span class="token operator">+</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">InputStream</span> input <span class="token operator">=</span> classPathResource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">ServletOutputStream</span> ouputStream <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeInput</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span>ouputStream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            ouputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            ouputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="【导入后端定制a】" tabindex="-1"><a class="header-anchor" href="#【导入后端定制a】"><span>【导入后端定制A】</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;任务表数据导入&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span><span class="token string">&quot;importProjectPlan&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ResourceMethod</span><span class="token punctuation">(</span>methodName <span class="token operator">=</span> <span class="token string">&quot;任务表数据导入&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@QueryLog</span><span class="token punctuation">(</span>detail <span class="token operator">=</span> <span class="token string">&quot;&#39;导入了文件名称为【&#39;+#file.getOriginalFilename()+&#39;】的数据到&#39;+#moduleName+&#39;列表中&#39;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">importProjectPlan</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span></span>
<span class="line">                                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;projectId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> projectId<span class="token punctuation">,</span></span>
<span class="line">                                        <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">importProjectPlan</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> projectId<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//表W_RWB数据导入</span></span>
<span class="line"><span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">importProjectPlan</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">String</span> projectId<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">importProjectPlan</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">String</span> projectId<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;导入成功!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> filename <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> fileType <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orgCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> importProjectPlanList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//0.读取数据</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                importProjectPlanList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelAnalysisHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token class-name">ProjectPlan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取第一页内容</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;mpp&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                importProjectPlanList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readMppPrjPlanInfo</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//1.校验数据</span></span>
<span class="line">            <span class="token keyword">int</span> startIndex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">String</span> checkMsg <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkImpPrjPlanInfo</span><span class="token punctuation">(</span>importProjectPlanList<span class="token punctuation">,</span>startIndex<span class="token punctuation">,</span>userCache<span class="token punctuation">,</span>orgCache<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>checkMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">=</span> checkMsg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>checkMsg<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;。&quot;</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>checkMsg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//2.导入数据</span></span>
<span class="line">            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">importPrjPlanInfo</span><span class="token punctuation">(</span>importProjectPlanList<span class="token punctuation">,</span>projectId<span class="token punctuation">,</span>userCache<span class="token punctuation">,</span>orgCache<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                msg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                msg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">TransactionAspectSupport</span><span class="token punctuation">.</span><span class="token function">currentTransactionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;请上传&quot;</span><span class="token operator">+</span>type<span class="token operator">+</span><span class="token string">&quot;格式文件！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//读取mpp文件数据</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> <span class="token function">readMppPrjPlanInfo</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> importProjectPlanList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">MPPReader</span> mppRead <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MPPReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">ProjectFile</span> pf <span class="token operator">=</span> mppRead<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> pf<span class="token punctuation">.</span><span class="token function">getAllTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            tasks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token operator">-&gt;</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> mjShow <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//密级</span></span>
<span class="line">                <span class="token class-name">String</span> wbsbm <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//WBS编码</span></span>
<span class="line">                <span class="token class-name">String</span> rwmc <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务名称</span></span>
<span class="line">                <span class="token class-name">String</span> rwlx <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务类型</span></span>
<span class="line">                <span class="token class-name">Date</span> jhkssj <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">Date</span> jhjssj <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getFinish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">String</span> fzr <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责人</span></span>
<span class="line">                <span class="token class-name">String</span> fzbm <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责部门</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getParentTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">ProjectPlan</span> projectPlan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProjectPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setMjShow</span><span class="token punctuation">(</span>mjShow<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setWbsbm</span><span class="token punctuation">(</span>wbsbm<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setRwmc</span><span class="token punctuation">(</span>rwmc<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setRwlx</span><span class="token punctuation">(</span>rwlx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setJhkssj</span><span class="token punctuation">(</span>jhkssj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setJhjssj</span><span class="token punctuation">(</span>jhjssj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setFzr</span><span class="token punctuation">(</span>fzr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    projectPlan<span class="token punctuation">.</span><span class="token function">setFzbm</span><span class="token punctuation">(</span>fzbm<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    importProjectPlanList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>projectPlan<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> importProjectPlanList<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//计划导入校验</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">checkImpPrjPlanInfo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> importProjectPlanList<span class="token punctuation">,</span><span class="token keyword">int</span> startIndex<span class="token punctuation">,</span></span>
<span class="line">                                   <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userCache<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orgCache<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> checkMsg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>importProjectPlanList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> rowNum <span class="token operator">=</span> startIndex<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProjectPlan</span> impPrjPlan <span class="token operator">:</span> importProjectPlanList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token operator">++</span>rowNum<span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">String</span> mjShow <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getMjShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//密级</span></span>
<span class="line">            <span class="token class-name">String</span> wbsbm <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//WBS编码</span></span>
<span class="line">            <span class="token class-name">String</span> rwmc <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getRwmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务名称</span></span>
<span class="line">            <span class="token class-name">String</span> rwlx <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getRwlx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务类型</span></span>
<span class="line">            <span class="token class-name">String</span> kjfcg <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getKjfcg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//可交付成果</span></span>
<span class="line">            <span class="token class-name">String</span> fzr <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责人</span></span>
<span class="line">            <span class="token class-name">String</span> fzbm <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责部门</span></span>
<span class="line">            <span class="token class-name">Date</span> jhkssj <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getJhkssj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//计划开始时间</span></span>
<span class="line">            <span class="token class-name">Date</span> jhjssj <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getJhjssj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//计划结束时间</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>mjShow<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;密级&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>wbsbm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;WBS编码&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>rwmc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;任务名称&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>rwlx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;任务类型&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">/*if(StringUtil.isEmpty(kjfcg)){</span>
<span class="line">                checkMsg += this.getValidMsg(rowNum,&quot;可交付成果&quot;,&quot;必填&quot;);</span>
<span class="line">            }*/</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>fzr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;负责人&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> fzrcode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserCode</span><span class="token punctuation">(</span>userCache<span class="token punctuation">,</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责人code</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>fzrcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;负责人&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;人员不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>fzbm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;负责部门&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> fzbmcode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOrgCode</span><span class="token punctuation">(</span>orgCache<span class="token punctuation">,</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责部门code</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>fzbmcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;负责部门&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;组织不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>jhkssj<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;计划开始时间&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>jhjssj<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;计划结束时间&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        checkMsg <span class="token operator">=</span> <span class="token string">&quot;不能导入无数据文件,&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> checkMsg<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//计划导入</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">importPrjPlanInfo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> importProjectPlanList<span class="token punctuation">,</span><span class="token class-name">String</span> projectId<span class="token punctuation">,</span></span>
<span class="line">                               <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userCache<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orgCache<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> prjInfoMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPrjPlanInfoMap</span><span class="token punctuation">(</span>projectId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//已存在的计划</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>importProjectPlanList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ProjectBasic</span> projectBasic <span class="token operator">=</span> projectBasicDao<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>projectId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//预生成或获取ID</span></span>
<span class="line">        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProjectPlan</span> impPrjPlan<span class="token operator">:</span>importProjectPlanList<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> impWbsbm <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>prjInfoMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>impWbsbm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                impPrjPlan<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>prjInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>impWbsbm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                impPrjPlan<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">UniqueIdUtil</span><span class="token punctuation">.</span><span class="token function">getUniqueIdString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                prjInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>impWbsbm<span class="token punctuation">,</span>impPrjPlan<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加入将要导入的计划</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mjInfoMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMjInfoMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> rwlxMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDicMapByAlias</span><span class="token punctuation">(</span><span class="token string">&quot;rwlx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//导入数据预处理（所属项目ID、上下级关系、密级、任务类型）</span></span>
<span class="line">        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProjectPlan</span> impPrjPlan<span class="token operator">:</span>importProjectPlanList<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//2.1 所属项目ID</span></span>
<span class="line">            impPrjPlan<span class="token punctuation">.</span><span class="token function">setSsxmid</span><span class="token punctuation">(</span>projectId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//2.2 上下级关系</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                impPrjPlan<span class="token punctuation">.</span><span class="token function">setSjrwid</span><span class="token punctuation">(</span><span class="token string">&quot;-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> parentWbsbm <span class="token operator">=</span> impPrjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span>prjInfoMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>parentWbsbm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    impPrjPlan<span class="token punctuation">.</span><span class="token function">setSjrwid</span><span class="token punctuation">(</span>prjInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>parentWbsbm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//2.3 密级</span></span>
<span class="line">            impPrjPlan<span class="token punctuation">.</span><span class="token function">setMj</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">obj2Long</span><span class="token punctuation">(</span>mjInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getMjShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//2.4 任务类型</span></span>
<span class="line">            impPrjPlan<span class="token punctuation">.</span><span class="token function">setRwlx</span><span class="token punctuation">(</span>rwlxMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getRwlx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//收集可以更新或导入的计划</span></span>
<span class="line">            <span class="token class-name">ProjectPlan</span> existPrjPlan <span class="token operator">=</span> prjInfoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>existPrjPlan<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> rwzxzt <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>existPrjPlan<span class="token punctuation">.</span><span class="token function">getRwzxzt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>rwzxzt<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;未审批&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>rwzxzt<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;进行中&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>rwzxzt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> diffFields <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">String</span> impFieldNames <span class="token operator">=</span> <span class="token string">&quot;mj,wbsbm,rwmc,rwlx,fzr,fzbm,jhkssj,jhjssj,sfwgdjh,&quot;</span> <span class="token operator">+</span></span>
<span class="line">                            <span class="token string">&quot;sfndkyscjh,ndjhyjjdbfb,sfqzqkyscjh,qzqjhyjjdbfb,sfwhtjfjd,sfwcgwbjh,sfwzlkzjd&quot;</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;进行中&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>rwzxzt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                        diffFields <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDifferentFieldNames</span><span class="token punctuation">(</span>existPrjPlan<span class="token punctuation">,</span>impPrjPlan<span class="token punctuation">,</span>impFieldNames<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setMj</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getMj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//密级</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setWbsbm</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//WBS编码</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setRwmc</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getRwmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务名称</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setRwlx</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getRwlx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务类型</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setKjfcg</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getKjfcg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//可交付成果</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setFzr</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责人</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setFzrcode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUserCode</span><span class="token punctuation">(</span>userCache<span class="token punctuation">,</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责人code</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setFzbm</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责部门</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setFzbmcode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOrgCode</span><span class="token punctuation">(</span>orgCache<span class="token punctuation">,</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getFzbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//负责部门code</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setJhkssj</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getJhkssj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//计划开始时间</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setJhjssj</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getJhjssj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//计划结束时间</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setSfwgdjh</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getSfwgdjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否为归档计划</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setSfndkyscjh</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getSfndkyscjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否年度科研生产计划</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setNdjhyjjdbfb</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getNdjhyjjdbfb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//年度计划预计进度百分比</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setSfqzqkyscjh</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getSfqzqkyscjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否全周期科研生产计划</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setQzqjhyjjdbfb</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getQzqjhyjjdbfb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//全周期计划预计进度百分比</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setSfwhtjfjd</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getSfwhtjfjd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否为合同交付节点</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setSfwcgwbjh</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getSfwcgwbjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否为采购外包计划</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setSfwzlkzjd</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getSfwzlkzjd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否为质量控制节点</span></span>
<span class="line">                    existPrjPlan<span class="token punctuation">.</span><span class="token function">setSjrwid</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">.</span><span class="token function">getSjrwid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//上级任务ID</span></span>
<span class="line">                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>existPrjPlan<span class="token punctuation">.</span><span class="token function">getRwbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                        existPrjPlan<span class="token punctuation">.</span><span class="token function">setRwbh</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initPrjPlanCode</span><span class="token punctuation">(</span>projectBasic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务编号</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>existPrjPlan<span class="token punctuation">.</span><span class="token function">getRwbs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                        existPrjPlan<span class="token punctuation">.</span><span class="token function">setRwbs</span><span class="token punctuation">(</span><span class="token string">&quot;xmrw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>existPrjPlan<span class="token punctuation">.</span><span class="token function">getXmlxkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                        existPrjPlan<span class="token punctuation">.</span><span class="token function">setXmlxkey</span><span class="token punctuation">(</span>projectBasic<span class="token punctuation">.</span><span class="token function">getXmlxkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    impPrjPlan <span class="token operator">=</span> existPrjPlan<span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>rwzxzt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        impPrjPlan<span class="token punctuation">.</span><span class="token function">setRwzxzt</span><span class="token punctuation">(</span><span class="token string">&quot;未审批&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务执行状态</span></span>
<span class="line">                        impPrjPlan<span class="token punctuation">.</span><span class="token function">setRwly</span><span class="token punctuation">(</span><span class="token string">&quot;项目管理系统&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//任务来源</span></span>
<span class="line">                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;进行中&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>rwzxzt<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> diffFields<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                            impPrjPlan<span class="token punctuation">.</span><span class="token function">setRwzxzt</span><span class="token punctuation">(</span><span class="token string">&quot;未审批&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>impPrjPlan<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//查询项目计划</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPrjPlanInfoMap</span><span class="token punctuation">(</span><span class="token class-name">String</span> prjId<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> prjInfoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProjectPlan</span><span class="token punctuation">&gt;</span></span> prjPlanList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPrjPlanList</span><span class="token punctuation">(</span>prjId<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>prjPlanList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProjectPlan</span> prjPlan<span class="token operator">:</span>prjPlanList<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            prjInfoMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>prjPlan<span class="token punctuation">.</span><span class="token function">getWbsbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>prjPlan<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> prjInfoMap<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getUserCode</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userCache<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> userCode <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>userCache<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        userCode <span class="token operator">=</span> userCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> pmSysService<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            userCode <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        userCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span>userCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> userCode<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getOrgCode</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orgCache<span class="token punctuation">,</span> <span class="token class-name">String</span> orgName<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> orgCode <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>orgCache<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>orgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        orgCode <span class="token operator">=</span> orgCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>orgName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOrg</span><span class="token punctuation">&gt;</span></span> orgList <span class="token operator">=</span> pmSysService<span class="token punctuation">.</span><span class="token function">getOrgByName</span><span class="token punctuation">(</span>orgName<span class="token punctuation">,</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>orgList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            orgCode <span class="token operator">=</span> orgList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        orgCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>orgName<span class="token punctuation">,</span>orgCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> orgCode<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getValidMsg</span><span class="token punctuation">(</span><span class="token keyword">int</span> rowNum<span class="token punctuation">,</span><span class="token class-name">String</span> colDes<span class="token punctuation">,</span><span class="token class-name">String</span> validType<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;第&quot;</span><span class="token operator">+</span>rowNum<span class="token operator">+</span><span class="token string">&quot;行【&quot;</span><span class="token operator">+</span>colDes<span class="token operator">+</span><span class="token string">&quot;】&quot;</span><span class="token operator">+</span>validType<span class="token operator">+</span><span class="token string">&quot;，&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDifferentFieldNames</span><span class="token punctuation">(</span><span class="token class-name">ProjectPlan</span> obj1<span class="token punctuation">,</span> <span class="token class-name">ProjectPlan</span> obj2<span class="token punctuation">,</span> <span class="token class-name">String</span> includeFields<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> differentFields <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> obj1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span>includeFields<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使私有属性也可以访问</span></span>
<span class="line">                    <span class="token class-name">Object</span> val1 <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">Object</span> val2 <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>val1 <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> val2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>val1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>val1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>val2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        differentFields<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> differentFields<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="line"> <span class="token comment">&lt;!-- 读取project文件 --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.sf.mpxj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mpxj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="【导入后端定制b】" tabindex="-1"><a class="header-anchor" href="#【导入后端定制b】"><span>【导入后端定制B】</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;导入&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span><span class="token string">&quot;importData&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ResourceMethod</span><span class="token punctuation">(</span>methodName <span class="token operator">=</span> <span class="token string">&quot;导入&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">importData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>manager<span class="token punctuation">.</span><span class="token function">importData</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//导入</span></span>
<span class="line"><span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">importData</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Override</span><span class="token comment">//导入</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">importData</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;导入成功!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orgCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//0.读取数据</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SubCcontract</span><span class="token punctuation">&gt;</span></span> importDataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelAnalysisHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span><span class="token class-name">SubCcontract</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取第一页内容</span></span>
<span class="line">        <span class="token comment">//1.校验数据</span></span>
<span class="line">        <span class="token keyword">int</span> startIndex <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> checkMsg <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkImpDataInfo</span><span class="token punctuation">(</span>importDataList<span class="token punctuation">,</span>startIndex<span class="token punctuation">,</span>orgCache<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>checkMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>checkMsg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//2.导入数据</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">importDataInfo</span><span class="token punctuation">(</span>importDataList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            msg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">            msg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">TransactionAspectSupport</span><span class="token punctuation">.</span><span class="token function">currentTransactionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//导入校验</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">checkImpDataInfo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SubCcontract</span><span class="token punctuation">&gt;</span></span> importDataList<span class="token punctuation">,</span><span class="token keyword">int</span> startIndex<span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orgCache<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> checkMsg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>importDataList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">int</span> rowNum <span class="token operator">=</span> startIndex<span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> snbhSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//所内编号集合</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> jfqcSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//甲方全称集合</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cddwSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//承担单位集合</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SubCcontract</span> impData <span class="token operator">:</span> importDataList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token operator">++</span>rowNum<span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Date</span> <span class="token class-name">Qdrq</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getQdrq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*签订日期</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Cddw</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getCddw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*承担单位</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Sfpzht</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSfpzht</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同类型</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Htbh</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getHtbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*所外编号</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Snbh</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSnbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*所内编号</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Htmc</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getHtmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同名称</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Cybkfl</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getCybkfl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*产业板块分类</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Jfqc</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getJfqc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*甲方全称</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Htjehs</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getHtjehs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同金额(含税)</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Sl</span> <span class="token operator">=</span> <span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">obj2Double</span><span class="token punctuation">(</span><span class="token class-name">MyNumUtil</span><span class="token punctuation">.</span><span class="token function">fixed</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*税率</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Htjebhs</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getHtjebhs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同金额(不含税)</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Zjcbysxebhs</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getZjcbysxebhs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*直接成本预算限额(不含税)</span></span>
<span class="line">            <span class="token class-name">String</span> <span class="token class-name">Htzt</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getHtzt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同状态</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Bnqdsrje</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getBnqdsrje</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*本年确定收入金额</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Bnkpje</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getBnkpje</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*本年开票金额</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Bncbkzje</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getBncbkzje</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*本年成本开支金额</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Bnhkje</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getBnhkje</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*本年回款金额</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Zbjbl</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getZbjbl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*质保金比例</span></span>
<span class="line">            <span class="token class-name">Double</span> <span class="token class-name">Htwcl</span> <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getHtwcl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同完成率</span></span>
<span class="line">            <span class="token class-name">String</span> htydjhsj <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getKhydjhsj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//合同约定交货时间</span></span>
<span class="line">            <span class="token class-name">String</span> sfwgjf <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSfwgjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否完工交付</span></span>
<span class="line">            <span class="token class-name">Date</span> sjjfrq <span class="token operator">=</span> impData<span class="token punctuation">.</span><span class="token function">getSjjfrq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实际交付日期</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;平转&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Sfpzht</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Snbh</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                snbhSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Snbh</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Jfqc</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                jfqcSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Jfqc</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Cddw</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                cddwSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Cddw</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            impData<span class="token punctuation">.</span><span class="token function">setSl</span><span class="token punctuation">(</span><span class="token class-name">Sl</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//必填校验</span></span>
<span class="line">            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> valArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">Qdrq</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token class-name">Cddw</span><span class="token punctuation">,</span><span class="token class-name">Sfpzht</span><span class="token punctuation">,</span><span class="token class-name">Htbh</span><span class="token punctuation">,</span><span class="token class-name">Snbh</span><span class="token punctuation">,</span><span class="token class-name">Htmc</span><span class="token punctuation">,</span><span class="token class-name">Cybkfl</span><span class="token punctuation">,</span><span class="token class-name">Jfqc</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token class-name">Htjehs</span><span class="token punctuation">,</span><span class="token class-name">Sl</span><span class="token punctuation">,</span><span class="token class-name">Htjebhs</span><span class="token punctuation">,</span><span class="token class-name">Zjcbysxebhs</span><span class="token punctuation">,</span><span class="token class-name">Htzt</span><span class="token punctuation">,</span><span class="token class-name">Bnqdsrje</span><span class="token punctuation">,</span><span class="token class-name">Bnkpje</span><span class="token punctuation">,</span><span class="token class-name">Bncbkzje</span><span class="token punctuation">,</span><span class="token class-name">Bnhkje</span><span class="token punctuation">,</span><span class="token class-name">Zbjbl</span><span class="token punctuation">,</span><span class="token class-name">Htwcl</span><span class="token punctuation">,</span></span>
<span class="line">                    htydjhsj<span class="token punctuation">,</span>sfwgjf<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nameArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;签订日期&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;承担单位&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;合同类型&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;所外编号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;所内编号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;合同名称&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">&quot;产业板块分类&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;甲方全称&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;合同金额(含税)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;税率&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">&quot;合同金额(不含税)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;直接成本预算限额(不含税)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;合同状态&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;本年确定收入金额&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;本年开票金额&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">&quot;本年成本开支金额&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;本年回款金额&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;质保金比例&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;合同完成率&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">&quot;合同约定交货时间&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;是否完工交付&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">=</span>valArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Object</span> val <span class="token operator">=</span> valArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">String</span> name <span class="token operator">=</span> nameArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">boolean</span> illegal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    illegal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    illegal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span>illegal<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span>name<span class="token punctuation">,</span><span class="token string">&quot;必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//合同约定交货时间</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">Date</span> htydjhsjDate <span class="token operator">=</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">parseDate</span><span class="token punctuation">(</span>htydjhsj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                htydjhsj <span class="token operator">=</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>htydjhsjDate<span class="token punctuation">,</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                impData<span class="token punctuation">.</span><span class="token function">setKhydjhsj</span><span class="token punctuation">(</span>htydjhsj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;客户指定&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>htydjhsj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;合同约定交货时间&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;应为“客户指定”或正确日期格式&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//实际交付日期</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>sfwgjf<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token string">&quot;否&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>sfwgjf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;是否完工交付&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;不在值域(是/否)中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>sfwgjf<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>sjjfrq<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;实际交付日期&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;完工交付后必填&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//部门校验</span></span>
<span class="line">            <span class="token comment">/*if(StringUtil.isNotEmpty(Cddw)){</span>
<span class="line">                String cddwCode = this.getOrgCode(orgCache,Cddw);//承担单位code</span>
<span class="line">                if(StringUtil.isEmpty(cddwCode)){</span>
<span class="line">                    checkMsg += this.getValidMsg(rowNum,&quot;承担单位&quot;,&quot;组织不存在&quot;);</span>
<span class="line">                }else{</span>
<span class="line">                    impData.setCddwcode(cddwCode);</span>
<span class="line">                }</span>
<span class="line">            }*/</span></span>
<span class="line">            <span class="token comment">//合同类型值域校验</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Sfpzht</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;平转/自签&quot;</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">Sfpzht</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;合同类型&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;不在值域(平转/自签)中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//合同状态值域校验</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Htzt</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;执行中/解除/中止/已完成&quot;</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">Htzt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;合同状态&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;不在值域(执行中/解除/中止/已完成)中&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//校验承担单位</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>cddwSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> querySql <span class="token operator">=</span> <span class="token string">&quot;SELECT F_BMBM,F_BMMC FROM W_GSBMB WHERE 1=1 &quot;</span> <span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">getFilterSql</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token string">&quot;F_BMMC=?&quot;</span><span class="token punctuation">,</span>cddwSet<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">JdbcTemplate</span> pmJdbc <span class="token operator">=</span> <span class="token class-name">DataSourceUtil</span><span class="token punctuation">.</span><span class="token function">getJdbcTempByDsAlias</span><span class="token punctuation">(</span><span class="token class-name">MyConst</span><span class="token punctuation">.</span>pmDataSourceAlias<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> pmJdbc<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>querySql<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getArgsFromSet</span><span class="token punctuation">(</span>cddwSet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap <span class="token operator">=</span> <span class="token class-name">MyListUtil</span><span class="token punctuation">.</span><span class="token function">list2Map</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span><span class="token string">&quot;F_BMMC&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;F_BMBM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            rowNum <span class="token operator">=</span> startIndex<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SubCcontract</span> impData <span class="token operator">:</span> importDataList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token operator">++</span>rowNum<span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">String</span> <span class="token class-name">Cddw</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getCddw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*承担单位</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Cddw</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token class-name">Cddw</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        checkMsg <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValidMsg</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">,</span><span class="token string">&quot;承担单位&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;在项目管理公司部门中不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token class-name">String</span> orgCode <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Cddw</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        impData<span class="token punctuation">.</span><span class="token function">setCddwcode</span><span class="token punctuation">(</span>orgCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//采购合同所外编号</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>snbhSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> filterSql <span class="token operator">=</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">getFilterSql</span><span class="token punctuation">(</span>item<span class="token operator">-&gt;</span><span class="token string">&quot;F_SNBH=?&quot;</span><span class="token punctuation">,</span>snbhSet<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">String</span> querySql <span class="token operator">=</span> <span class="token string">&quot;SELECT F_SNBH FROM W_CGHTTZB WHERE 1=1 &quot;</span><span class="token operator">+</span>filterSql<span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>querySql<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getArgsFromSet</span><span class="token punctuation">(</span>snbhSet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            snbhSet<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            dataList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token operator">-&gt;</span>snbhSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;F_SNBH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SubCcontract</span> impData <span class="token operator">:</span> importDataList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> <span class="token class-name">Htmc</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getHtmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同名称</span></span>
<span class="line">                <span class="token class-name">String</span> <span class="token class-name">Sfpzht</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSfpzht</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同类型</span></span>
<span class="line">                <span class="token class-name">String</span> <span class="token class-name">Snbh</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSnbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*所内编号</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;平转&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Sfpzht</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Snbh</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>snbhSet<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">Snbh</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    checkMsg <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token class-name">Htmc</span><span class="token operator">+</span><span class="token string">&quot; 合同名称 &quot;</span><span class="token operator">+</span><span class="token class-name">Snbh</span><span class="token operator">+</span><span class="token string">&quot; 所内编号错误，&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">//校验甲方全称</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>jfqcSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> querySql <span class="token operator">=</span> <span class="token string">&quot;SELECT ID_,F_GSMC FROM W_KHXXTZ WHERE 1=1 &quot;</span><span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">getFilterSql</span><span class="token punctuation">(</span>item<span class="token operator">-&gt;</span><span class="token string">&quot;F_GSMC=?&quot;</span><span class="token punctuation">,</span>jfqcSet<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">JdbcTemplate</span> connJdbc <span class="token operator">=</span> <span class="token class-name">DataSourceUtil</span><span class="token punctuation">.</span><span class="token function">getJdbcTempByDsAlias</span><span class="token punctuation">(</span><span class="token class-name">MyConst</span><span class="token punctuation">.</span>connectionDataSourceAlias<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> connJdbc<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>querySql<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getArgsFromSet</span><span class="token punctuation">(</span>jfqcSet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataMap <span class="token operator">=</span> <span class="token class-name">MyListUtil</span><span class="token punctuation">.</span><span class="token function">list2Map</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span><span class="token string">&quot;F_GSMC&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ID_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">boolean</span> illegal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SubCcontract</span> impData <span class="token operator">:</span> importDataList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span> <span class="token class-name">Htmc</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getHtmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*合同名称</span></span>
<span class="line">                <span class="token class-name">String</span> <span class="token class-name">Jfqc</span> <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getJfqc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//*甲方全称</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token class-name">Jfqc</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dataMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token class-name">Jfqc</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                        checkMsg <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token class-name">Htmc</span> <span class="token operator">+</span> <span class="token string">&quot; 合同名称 &quot;</span> <span class="token operator">+</span> <span class="token class-name">Jfqc</span> <span class="token operator">+</span> <span class="token string">&quot; 甲方在子公司客户档案中不存在，&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        illegal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token class-name">String</span> jfdwId <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Jfqc</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        impData<span class="token punctuation">.</span><span class="token function">setJfdwid</span><span class="token punctuation">(</span>jfdwId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>illegal<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                checkMsg <span class="token operator">+=</span> <span class="token string">&quot;请先维护客户信息；&quot;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        checkMsg <span class="token operator">=</span> <span class="token string">&quot;不能导入无数据文件&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> checkMsg<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getOrgCode</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orgCache<span class="token punctuation">,</span> <span class="token class-name">String</span> orgName<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> orgCode <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>orgCache<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>orgName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        orgCode <span class="token operator">=</span> orgCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>orgName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOrg</span><span class="token punctuation">&gt;</span></span> orgList <span class="token operator">=</span> contractSysService<span class="token punctuation">.</span><span class="token function">getOrgByName</span><span class="token punctuation">(</span>orgName<span class="token punctuation">,</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>orgList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            orgCode <span class="token operator">=</span> orgList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        orgCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>orgName<span class="token punctuation">,</span>orgCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> orgCode<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getValidMsg</span><span class="token punctuation">(</span><span class="token keyword">int</span> rowNum<span class="token punctuation">,</span><span class="token class-name">String</span> colDes<span class="token punctuation">,</span><span class="token class-name">String</span> validType<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;第&quot;</span><span class="token operator">+</span>rowNum<span class="token operator">+</span><span class="token string">&quot;行【&quot;</span><span class="token operator">+</span>colDes<span class="token operator">+</span><span class="token string">&quot;】&quot;</span><span class="token operator">+</span>validType<span class="token operator">+</span><span class="token string">&quot;；&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">//导入数据</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">importDataInfo</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SubCcontract</span><span class="token punctuation">&gt;</span></span> importDataList<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">CommonTools</span><span class="token punctuation">.</span><span class="token function">isNotEmptyList</span><span class="token punctuation">(</span>importDataList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> snbhSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        importDataList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token operator">-&gt;</span>snbhSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getSnbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//已存在的合同编号</span></span>
<span class="line">        <span class="token class-name">String</span> whereSql <span class="token operator">=</span> <span class="token string">&quot;NVL(F_SNBH,&#39;&#39;)!=&#39;&#39; &quot;</span> <span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">getFilterSql</span><span class="token punctuation">(</span>item<span class="token operator">-&gt;</span><span class="token string">&quot;F_SNBH=&#39;&quot;</span><span class="token operator">+</span>item<span class="token operator">+</span><span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">,</span>snbhSet<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SubCcontract</span><span class="token punctuation">&gt;</span></span> subCcontractList <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDefaultFilter</span><span class="token punctuation">(</span>whereSql<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">SubCcontract</span><span class="token punctuation">&gt;</span></span> subHtMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        subCcontractList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token operator">-&gt;</span>subHtMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getSnbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//导入</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> excludeFields <span class="token operator">=</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token string">&quot;id,mj,spzt,snbh,gxsj,sfxz,drsjxsz&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> includeFields <span class="token operator">=</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token string">&quot;ljyqrsrje,bnqdsrje,ljykpje,bnkpje,ljykzcbje,bncbkzje,ljyhkje,bnhkje,zbjbl,htwcl,sfwgjf,sjjfrq&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> curUserName <span class="token operator">=</span> <span class="token class-name">UserContextUtil</span><span class="token punctuation">.</span><span class="token function">getCurrentUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> curUserCode <span class="token operator">=</span> <span class="token class-name">UserContextUtil</span><span class="token punctuation">.</span><span class="token function">getCurrentUserCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Date</span> gxsj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SubCcontract</span> impData <span class="token operator">:</span> importDataList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//导入人赋值</span></span>
<span class="line">            impData<span class="token punctuation">.</span><span class="token function">setDrr</span><span class="token punctuation">(</span>curUserName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            impData<span class="token punctuation">.</span><span class="token function">setDrrcode</span><span class="token punctuation">(</span>curUserCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//更新时间赋值</span></span>
<span class="line">            impData<span class="token punctuation">.</span><span class="token function">setGxsj</span><span class="token punctuation">(</span>gxsj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            impData<span class="token punctuation">.</span><span class="token function">setDrsjxsz</span><span class="token punctuation">(</span>gxsj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//更新、新增</span></span>
<span class="line">            <span class="token class-name">SubCcontractHis</span> subCcontractHis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>subHtMap<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSnbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">SubCcontract</span> uptObj <span class="token operator">=</span> subHtMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSnbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">String</span> spzt <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>uptObj<span class="token punctuation">.</span><span class="token function">getSpzt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;审批中&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>spzt<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;变更中&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>spzt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> updateFields <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDifferentFieldNames</span><span class="token punctuation">(</span>uptObj<span class="token punctuation">,</span> impData<span class="token punctuation">,</span> excludeFields<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span><span class="token punctuation">(</span>updateFields<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">boolean</span> otherFieldUpdate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasOtherFieldUpdate</span><span class="token punctuation">(</span>updateFields<span class="token punctuation">,</span> includeFields<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyNotNullProperties</span><span class="token punctuation">(</span>uptObj<span class="token punctuation">,</span> impData<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;已审批&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>spzt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                            <span class="token keyword">if</span><span class="token punctuation">(</span>otherFieldUpdate<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                                uptObj<span class="token punctuation">.</span><span class="token function">setSpzt</span><span class="token punctuation">(</span><span class="token string">&quot;待变更&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                            uptObj<span class="token punctuation">.</span><span class="token function">setSpzt</span><span class="token punctuation">(</span><span class="token string">&quot;未审批&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                        <span class="token keyword">if</span><span class="token punctuation">(</span>otherFieldUpdate<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                            uptObj<span class="token punctuation">.</span><span class="token function">setSfxz</span><span class="token punctuation">(</span><span class="token string">&quot;否&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//变更</span></span>
<span class="line">                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                            uptObj<span class="token punctuation">.</span><span class="token function">setSfxz</span><span class="token punctuation">(</span><span class="token string">&quot;其他&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据维护</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                        dao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>uptObj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        subCcontractHis <span class="token operator">=</span> <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>uptObj<span class="token punctuation">,</span> <span class="token class-name">SubCcontractHis</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        subCcontractHis<span class="token punctuation">.</span><span class="token function">setRefId</span><span class="token punctuation">(</span>uptObj<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        subCcontractHis<span class="token punctuation">.</span><span class="token function">setGxzd</span><span class="token punctuation">(</span><span class="token class-name">MySetUtil</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>updateFields<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                impData<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">UniqueIdUtil</span><span class="token punctuation">.</span><span class="token function">getUniqueIdString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//主键</span></span>
<span class="line">                impData<span class="token punctuation">.</span><span class="token function">setMj</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//密级</span></span>
<span class="line">                impData<span class="token punctuation">.</span><span class="token function">setSpzt</span><span class="token punctuation">(</span><span class="token string">&quot;未审批&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//审批状态</span></span>
<span class="line">                impData<span class="token punctuation">.</span><span class="token function">setSfxz</span><span class="token punctuation">(</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//新增</span></span>
<span class="line">                dao<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>impData<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                subCcontractHis <span class="token operator">=</span> <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>impData<span class="token punctuation">,</span><span class="token class-name">SubCcontractHis</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                subCcontractHis<span class="token punctuation">.</span><span class="token function">setRefId</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                subHtMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>impData<span class="token punctuation">.</span><span class="token function">getSnbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>impData<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//生成历史记录</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span>subCcontractHis<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                subCcontractHis<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">UniqueIdUtil</span><span class="token punctuation">.</span><span class="token function">getUniqueIdString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                subCcontractHisDao<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>subCcontractHis<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">DefaultQueryFilter</span> <span class="token function">getDefaultFilter</span><span class="token punctuation">(</span><span class="token class-name">String</span> whereSql<span class="token punctuation">,</span> <span class="token class-name">String</span> orderBySql<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">DefaultQueryFilter</span> queryFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultQueryFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    queryFilter<span class="token punctuation">.</span><span class="token function">setPage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    queryFilter<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;whereSql&quot;</span><span class="token punctuation">,</span> whereSql<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    queryFilter<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;orderBySql&quot;</span><span class="token punctuation">,</span> orderBySql<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> queryFilter<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getArgsFromSet</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataSet<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>dataSet<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dataSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>dataSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> item<span class="token operator">:</span>dataSet<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            args<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> args<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getDifferentFieldNames</span><span class="token punctuation">(</span><span class="token class-name">SubCcontract</span> obj1<span class="token punctuation">,</span> <span class="token class-name">SubCcontract</span> obj2<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> excludeFields<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> differentFields <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> obj1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>excludeFields<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使私有属性也可以访问</span></span>
<span class="line">                    <span class="token class-name">Object</span> val1 <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">Object</span> val2 <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>val1 <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> val2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>val1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>val1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>val2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        differentFields<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> differentFields<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">hasOtherFieldUpdate</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> updateFields<span class="token punctuation">,</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> includeFields<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> uptField<span class="token operator">:</span>updateFields<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>includeFields<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>uptField<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            res <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> res<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-导出" tabindex="-1"><a class="header-anchor" href="#_4-导出"><span>4 导出</span></a></h2><h3 id="【word导出】" tabindex="-1"><a class="header-anchor" href="#【word导出】"><span>【Word导出】</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@Override</span><span class="token comment">//申请单PDF导出</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">exportApplyPdfFromWord</span><span class="token punctuation">(</span><span class="token class-name">String</span> applyId<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">OutreviseApply</span> outreviseApply <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>applyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OutreviseDetail</span><span class="token punctuation">&gt;</span></span> outreviseDetailList <span class="token operator">=</span> outreviseDetailDao<span class="token punctuation">.</span><span class="token function">getByRefId</span><span class="token punctuation">(</span>applyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token string">&quot;outreviseApply.doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//子表信息</span></span>
<span class="line">    <span class="token class-name">String</span> tableName <span class="token operator">=</span> <span class="token string">&quot;subList&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> colNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;xh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wzmc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ggxh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zylb&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;dw&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;cksl&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;dj&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;je&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jcf&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;htbh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jcyqz&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> rowList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">MaterialCatalog</span><span class="token punctuation">&gt;</span></span> cacheMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">=</span>outreviseDetailList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">OutreviseDetail</span> outreviseDetail <span class="token operator">=</span> outreviseDetailList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> zylb <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span><span class="token comment">//重要类别</span></span>
<span class="line">        <span class="token class-name">MaterialCatalog</span> materialCatalog <span class="token operator">=</span> materialCatalogManager<span class="token punctuation">.</span><span class="token function">getPoByWzbm</span><span class="token punctuation">(</span>outreviseDetail<span class="token punctuation">.</span><span class="token function">getWzbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cacheMap<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>materialCatalog<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            zylb <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>materialCatalog<span class="token punctuation">.</span><span class="token function">getZylb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> colList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//序号</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outreviseDetail<span class="token punctuation">.</span><span class="token function">getWzmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//物资名称</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outreviseDetail<span class="token punctuation">.</span><span class="token function">getGgxh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//规格型号</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>zylb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重要类别</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outreviseDetail<span class="token punctuation">.</span><span class="token function">getDw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//单位</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outreviseDetail<span class="token punctuation">.</span><span class="token function">getCzsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//出库数量</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//单价</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//金额</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测费</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//合同编号</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测员签章</span></span>
<span class="line">        rowList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>colList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">fillPreviewDatas</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span>tableName<span class="token punctuation">,</span>colNames<span class="token punctuation">,</span>rowList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//主表信息</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> formInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">String</span> gzdh <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span><span class="token comment">//工作代号</span></span>
<span class="line">        <span class="token class-name">String</span> ckdh <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span><span class="token comment">//出库单号</span></span>
<span class="line">        <span class="token class-name">String</span> czdh <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getSqdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//冲正单号</span></span>
<span class="line">        <span class="token class-name">String</span> czrq <span class="token operator">=</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getSqsj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//冲正日期</span></span>
<span class="line">        <span class="token class-name">String</span> hjje <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getCzzhj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//合计金额</span></span>
<span class="line">        <span class="token class-name">String</span> jcfxj <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getCzjcf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测费小计</span></span>
<span class="line">        <span class="token class-name">String</span> czyy <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getCzyy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//冲正原因</span></span>
<span class="line">        <span class="token class-name">String</span> jbr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span><span class="token comment">//经办人</span></span>
<span class="line">        <span class="token class-name">String</span> ckr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span><span class="token comment">//出库人</span></span>
<span class="line">        <span class="token class-name">String</span> llr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span><span class="token comment">//领料人</span></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;物资物料采购&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getSjly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">OutstorageApplay</span> outstorageApplay <span class="token operator">=</span> outstorageApplayDao<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getCkdid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            gzdh <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outstorageApplay<span class="token punctuation">.</span><span class="token function">getKtbbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            ckdh <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outstorageApplay<span class="token punctuation">.</span><span class="token function">getCkdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            jbr <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outstorageApplay<span class="token punctuation">.</span><span class="token function">getSqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            ckr <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outstorageApplay<span class="token punctuation">.</span><span class="token function">getCkr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            llr <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outstorageApplay<span class="token punctuation">.</span><span class="token function">getLlr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//外包外协采购</span></span>
<span class="line">            <span class="token class-name">OutboundApply</span> outboundApply <span class="token operator">=</span> outboundApplyDao<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>outreviseApply<span class="token punctuation">.</span><span class="token function">getCkdid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            gzdh <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outboundApply<span class="token punctuation">.</span><span class="token function">getKtbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            ckdh <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outboundApply<span class="token punctuation">.</span><span class="token function">getSqdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            jbr <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outboundApply<span class="token punctuation">.</span><span class="token function">getSqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            ckr <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outboundApply<span class="token punctuation">.</span><span class="token function">getCkr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            llr <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>outboundApply<span class="token punctuation">.</span><span class="token function">getLlrxm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;gzdh&quot;</span><span class="token punctuation">,</span>gzdh<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ckdh&quot;</span><span class="token punctuation">,</span>ckdh<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;czdh&quot;</span><span class="token punctuation">,</span>czdh<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;czrq&quot;</span><span class="token punctuation">,</span>czrq<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;hjje&quot;</span><span class="token punctuation">,</span>hjje<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;jcfxj&quot;</span><span class="token punctuation">,</span>jcfxj<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;czyy&quot;</span><span class="token punctuation">,</span>czyy<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;jbr&quot;</span><span class="token punctuation">,</span>jbr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ckr&quot;</span><span class="token punctuation">,</span>ckr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;llr&quot;</span><span class="token punctuation">,</span>llr<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">fillFormFields</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span>formInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> myUtilManager<span class="token punctuation">.</span><span class="token function">exportMergePDF</span><span class="token punctuation">(</span><span class="token string">&quot;冲正申请单&quot;</span><span class="token punctuation">,</span><span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">getPdfBytes</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">,</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="【excel导出】" tabindex="-1"><a class="header-anchor" href="#【excel导出】"><span>【Excel导出】</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@Override</span><span class="token comment">//导出物资采购申请明细表</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exportPurchaseApplyDetail</span><span class="token punctuation">(</span><span class="token class-name">JSONObject</span> params<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> cgsqIds <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;cgsqIds&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//查询导出数据</span></span>
<span class="line">    <span class="token class-name">String</span> filterSql <span class="token operator">=</span> <span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">getFilterSql</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token string">&quot;ID_=&#39;&quot;</span><span class="token operator">+</span>item<span class="token operator">+</span><span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">,</span>cgsqIds<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> querySql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM V_PURCHASES_APPLY WHERE 1=1 &quot;</span><span class="token operator">+</span>filterSql<span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//导出数据</span></span>
<span class="line">    <span class="token class-name">Excel</span> excel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Excel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> title <span class="token operator">=</span> <span class="token string">&quot;物资采购申请明细表&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;序号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;审批状态&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;申请单号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;课题本号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;项目名称&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;设备名称&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;申请人&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;申请部门&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;申请时间&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;审批完成时间&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;采购类型&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;业务类型&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;要求到货时间&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;物资编码&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;物资名称&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;规格型号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;制造商&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;重要类别&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;计量单位&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;数量&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;起订量&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;最高价(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;最低价(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;基准价格(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;协议价格(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;预算金额(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;协议金额(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;采购定价(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;定价金额(元)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;主要技术参数&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;反馈单编号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;取消未采购定价单号&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;发料课题本号&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;备注&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;一级品类&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;二级品类&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;三级品类&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;四级品类&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;采购周期(天)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;该物料本年度采购申请数量累计&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;该物料本年度采购申请次数累计&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//表头</span></span>
<span class="line">    <span class="token keyword">int</span> headerIndex <span class="token operator">=</span> <span class="token class-name">MyExcelUtil</span><span class="token punctuation">.</span><span class="token function">fillHeaders</span><span class="token punctuation">(</span>excel<span class="token punctuation">,</span>headers<span class="token punctuation">,</span>title<span class="token punctuation">,</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//表体</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> pageSqls <span class="token operator">=</span> <span class="token class-name">MyJdbcUtil</span><span class="token punctuation">.</span><span class="token function">getPageSqls</span><span class="token punctuation">(</span>jdbcTemplate<span class="token punctuation">,</span>querySql<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> startIndex <span class="token operator">=</span> headerIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> pageSql<span class="token operator">:</span>pageSqls<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>pageSql<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        startIndex <span class="token operator">=</span> <span class="token class-name">MyExcelUtil</span><span class="token punctuation">.</span><span class="token function">fillBodyByMapList_Add</span><span class="token punctuation">(</span>excel<span class="token punctuation">,</span>dataList<span class="token punctuation">,</span>startIndex<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//下载</span></span>
<span class="line">    <span class="token class-name">MyExcelUtil</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>excel<span class="token punctuation">,</span>response<span class="token punctuation">,</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="【pdf导出】" tabindex="-1"><a class="header-anchor" href="#【pdf导出】"><span>【PDF导出】</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@Override</span><span class="token comment">//采购申请单PDF导出</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">exportApplyPdf</span><span class="token punctuation">(</span><span class="token class-name">String</span> applyId<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> pdfBytesList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//数据准备</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> xmlxMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;xhxm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;kyxm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;cyhxm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;jgxm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mpxm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;kxxm&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mjMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;6&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;9&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//1.导出主表</span></span>
<span class="line">    <span class="token class-name">PurchaseApply</span> purchaseApply <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>applyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> txtFillMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;applyCode&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSqdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//编号-申请单号</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;purDept&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSqbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请部门</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;purTime&quot;</span><span class="token punctuation">,</span><span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSqrq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请日期</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;purName&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSqr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请人</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;contact&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getLxdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//联系电话</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;projName&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getKtbmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//项目名称</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;subjectBookCode&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getKtbh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//课题本号</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;purchaseType&quot;</span><span class="token punctuation">,</span>xmlxMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getXmlx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//项目类型</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;totalPrices&quot;</span><span class="token punctuation">,</span><span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getCghj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//预算金额-采购合计</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;qualitycost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSfjrzlcb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token string">&quot;10&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否计入质量成本</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;isSingleSource&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSfdylycg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token string">&quot;10&quot;</span><span class="token operator">:</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否单一来源采购</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;isCooperation&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;是&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSfnbxzpt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token string">&quot;1&quot;</span><span class="token operator">:</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否内部协作配套</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;securityLevel&quot;</span><span class="token punctuation">,</span>mjMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getMj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//密级</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> opinionInfo <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getFlowOpinionInfo</span><span class="token punctuation">(</span>applyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> nodeKeyPath <span class="token operator">=</span> <span class="token string">&quot;UserTask_1hajpk0,UserTask_0q5nux3,UserTask_1qbrq3m,UserTask_1lh6l3m,UserTask_0z4l2iz,UserTask_1otulsi,UserTask_qct2MKR,StartEvent_qct2MKR&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;suggestion_0&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;opinion&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSqbmyj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1otulsi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请部门意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;suggestion_1&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;opinion&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getKtbcdbmyj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_0z4l2iz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//课题本承担部门意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;suggestion_2&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;opinion&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getYwzgbmyj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1qbrq3m&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//业务主管部门意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;suggestion_3&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;opinion&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getYwzgsldyj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_0q5nux3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//业务主管所领导意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;suggestion_4&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;opinion&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSzspyj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1hajpk0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//所长审批意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditTime_0&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1otulsi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请部门意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditTime_1&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_0z4l2iz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//课题本承担部门意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditTime_2&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1qbrq3m&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//业务主管部门意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditTime_3&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_0q5nux3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//业务主管所领导意见</span></span>
<span class="line">    txtFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditTime_4&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1hajpk0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//所长审批意见</span></span>
<span class="line">    <span class="token class-name">String</span> sqbmsprcode <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSqbmsprcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1otulsi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> ktbcdbmsprcode <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getKtbcdbmsprcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_0z4l2iz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> ywzgbmsprcode <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getYwzgbmsprcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1qbrq3m&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> ywzgsldsprcode <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getYwzgsldsprcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_0q5nux3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> szsprcode <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getSkipFlowNodeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;userCode&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSzsprcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>opinionInfo<span class="token punctuation">,</span>nodeKeyPath<span class="token punctuation">,</span><span class="token string">&quot;UserTask_1hajpk0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> imgFillMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    imgFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditUser_0&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getUserSignatureBlob</span><span class="token punctuation">(</span>sqbmsprcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请部门签字</span></span>
<span class="line">    imgFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditUser_1&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getUserSignatureBlob</span><span class="token punctuation">(</span>ktbcdbmsprcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//课题本承担部门签字</span></span>
<span class="line">    imgFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditUser_2&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getUserSignatureBlob</span><span class="token punctuation">(</span>ywzgbmsprcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//业务主管部门签字</span></span>
<span class="line">    imgFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditUser_3&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getUserSignatureBlob</span><span class="token punctuation">(</span>ywzgsldsprcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//业务主管所领导签字</span></span>
<span class="line">    imgFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;auditUser_4&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getUserSignatureBlob</span><span class="token punctuation">(</span>szsprcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//所长签字</span></span>
<span class="line">    imgFillMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;barCode&quot;</span><span class="token punctuation">,</span>myUtilManager<span class="token punctuation">.</span><span class="token function">getBarCodeBlob</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getSqdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//条形码</span></span>
<span class="line">    <span class="token class-name">String</span> templateFilePath <span class="token operator">=</span> <span class="token string">&quot;template/materialPurchase/1物资采购申请_采购申请表.pdf&quot;</span><span class="token punctuation">;</span><span class="token comment">//resource目录下</span></span>
<span class="line">    pdfBytesList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MyPdfUtil</span><span class="token punctuation">.</span><span class="token function">getMergedBytes</span><span class="token punctuation">(</span>templateFilePath<span class="token punctuation">,</span>txtFillMap<span class="token punctuation">,</span>imgFillMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//2.导出子表</span></span>
<span class="line">    <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token string">&quot;purchaseDetailSubList.doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> formInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ktbmc&quot;</span><span class="token punctuation">,</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getKtbmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//课题本名称</span></span>
<span class="line">        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;hj&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span><span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span>purchaseApply<span class="token punctuation">.</span><span class="token function">getCghj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//合计</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">fillFormFields</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span>formInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> tableName <span class="token operator">=</span> <span class="token string">&quot;subList&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> colNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;xh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wzmc&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ggxh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sanjpl&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zylb&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;jldw&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;sl&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nxgf&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ckdj&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ckje&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bz&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> rowList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">PricingSupply</span><span class="token punctuation">&gt;</span></span> psCacheMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PurchaseDetail</span><span class="token punctuation">&gt;</span></span> purchaseDetailList <span class="token operator">=</span> purchaseDetailDao<span class="token punctuation">.</span><span class="token function">getByRefId</span><span class="token punctuation">(</span>applyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>size<span class="token operator">=</span>purchaseDetailList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">PurchaseDetail</span> purchaseDetail <span class="token operator">=</span> purchaseDetailList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> colList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//序号</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getWzmc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//物资名称</span></span>
<span class="line">        <span class="token class-name">String</span> ggxh <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getGgxh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//规格型号</span></span>
<span class="line">        <span class="token class-name">String</span> jscs <span class="token operator">=</span> <span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getJscsjysyq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//技术参数</span></span>
<span class="line">        ggxh <span class="token operator">+=</span> <span class="token class-name">StringUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>jscs<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token string">&quot;，&quot;</span><span class="token operator">+</span>jscs<span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ggxh<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getSjpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//三级品类</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getZylb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重要类别</span></span>
<span class="line">        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> wzwlml_jldw <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getDicValInfoMap</span><span class="token punctuation">(</span><span class="token string">&quot;wzwlml_jldw&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ibms-712S-purchases&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>wzwlml_jldw<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>ibms<span class="token punctuation">.</span>purchases<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getJldw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//计量单位</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getCgsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//采购数量</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>pricingApplyManager<span class="token punctuation">.</span><span class="token function">getNxgfNamesByApplyIds</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getDydjdid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>psCacheMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//拟选供方</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span><span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getYjdj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//预计单价</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span><span class="token string">&quot;￥ &quot;</span><span class="token operator">+</span><span class="token class-name">MyStringUtil</span><span class="token punctuation">.</span><span class="token function">comdify</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getYjjexj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//预计金额小计</span></span>
<span class="line">        colList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CommonTools<span class="token punctuation">.</span>Obj2String</span><span class="token punctuation">(</span>purchaseDetail<span class="token punctuation">.</span><span class="token function">getBz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//备注</span></span>
<span class="line">        rowList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>colList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">fillPreviewDatas</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span>tableName<span class="token punctuation">,</span>colNames<span class="token punctuation">,</span>rowList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    pdfBytesList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MyWordUtil</span><span class="token punctuation">.</span><span class="token function">getPdfBytes</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> myUtilManager<span class="token punctuation">.</span><span class="token function">exportMergePDF</span><span class="token punctuation">(</span><span class="token string">&quot;物资采购申请_采购申请表&quot;</span><span class="token punctuation">,</span>pdfBytesList<span class="token punctuation">,</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-接口开发" tabindex="-1"><a class="header-anchor" href="#_5-接口开发"><span>5 接口开发</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token annotation punctuation">@Override</span><span class="token comment">//MES二级库出库结果推送接口</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">pushDetailMesInterface</span><span class="token punctuation">(</span><span class="token class-name">String</span> applyId<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//推送参数</span></span>
<span class="line">    <span class="token class-name">String</span> querySql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM MES_SECOUTSTORAGE_DETAIL WHERE ID_=&#39;&quot;</span><span class="token operator">+</span>applyId<span class="token operator">+</span><span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span>querySql<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">JSONArray</span> params <span class="token operator">=</span> <span class="token class-name">MyListUtil</span><span class="token punctuation">.</span><span class="token function">toJsonArr</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//请求</span></span>
<span class="line">    <span class="token class-name">String</span> reqUrl <span class="token operator">=</span> myUtilManager<span class="token punctuation">.</span><span class="token function">getSysParamVal</span><span class="token punctuation">(</span><span class="token string">&quot;pushSecoutDataToMes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">JSONObject</span> res <span class="token operator">=</span> <span class="token class-name">MyHttpUtil</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>reqUrl<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">boolean</span> isSuccess <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> message <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>isSuccess<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SecoutstorageApplay</span> secoutstorageApplay <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>applyId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        secoutstorageApplay<span class="token punctuation">.</span><span class="token function">setMestszt</span><span class="token punctuation">(</span><span class="token string">&quot;成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        dao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>secoutstorageApplay<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script src="/CodeHelper/assets/js/runtime~app.19208902.js" defer></script><script src="/CodeHelper/assets/js/639.a736eac9.js" defer></script><script src="/CodeHelper/assets/js/app.e67bbaa2.js" defer></script>
  </body>
</html>
